<div class="test-container">
  <h1 class="page-title">Тестирование</h1>

  <!-- Toggle buttons -->


  <!-- Action buttons -->
  <div class="action-buttons">
    <button mat-raised-button color="accent" (click)="onValidatorClick()">
      <mat-icon>check_circle</mat-icon>
      Предрасчет
    </button>
    <button mat-raised-button color="primary" (click)="onCalculatorClick()">
      <mat-icon>calculate</mat-icon>
      Расчет
    </button>
    
    <mat-form-field appearance="outline" class="pf-type-field">
      <mat-label>Тип формы</mat-label>
      <mat-select [(ngModel)]="selectedPfType">
        <mat-option *ngFor="let pfType of pfTypes" [value]="pfType.code">
          {{pfType.name}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-raised-button color="warn" (click)="onPrintPfClick()">
      <mat-icon>print</mat-icon>
      ПФ
    </button>
  </div>

  <!-- Request JSON Card -->
  <mat-card class="request-card">
    <mat-card-header>
      <mat-card-title>
        <h2>Запрос</h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>JSON запрос</mat-label>
        <textarea 
          matInput 
          [(ngModel)]="requestJson" 
          rows="8" 
          placeholder='{"key": "value"}'
          class="json-textarea">
        </textarea>
      </mat-form-field>
    </mat-card-content>
  </mat-card>


  <!-- Error Table Card -->
  <mat-card class="table-card">
    <mat-card-header>
      <mat-card-title>
        <h2>Ошибки валидации</h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="errorData" class="error-table">
        <ng-container matColumnDef="errorText">
          <th mat-header-cell *matHeaderCellDef> errorText </th>
          <td mat-cell *matCellDef="let error"> {{error.errorText}} </td>
        </ng-container>

        <ng-container matColumnDef="validator">
          <th mat-header-cell *matHeaderCellDef> validator </th>
          <td mat-cell *matCellDef="let error"> {{error.validator}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="errorDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: errorDisplayedColumns;"></tr>
      </table>

      <mat-paginator 
        #errorPaginator
        [pageSizeOptions]="[5, 10, 25]" 
        showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>

  <!-- Calculation Result Card -->
  <mat-card class="result-card">
    <mat-card-header>
      <mat-card-title>
        <h2>Результат расчета</h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Результат</mat-label>
        <textarea 
          matInput 
          [ngModel]="calculationResult" 
          readonly
          rows="10"
          class="result-textarea">
        </textarea>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <!-- Context Table Card -->
  <mat-card class="table-card">
    <mat-card-header>
      <mat-card-title>
        <h2>Контекст расчета</h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="contextData" class="context-table">
        <ng-container matColumnDef="varCode">
          <th mat-header-cell *matHeaderCellDef> varCode </th>
          <td mat-cell *matCellDef="let context"> {{context.varCode}} </td>
        </ng-container>

        <ng-container matColumnDef="varValue">
          <th mat-header-cell *matHeaderCellDef> varValue </th>
          <td mat-cell *matCellDef="let context"> {{context.varValue}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="contextDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: contextDisplayedColumns;"></tr>
      </table>

      <mat-paginator 
        #contextPaginator
        [pageSizeOptions]="[5, 10, 25]" 
        showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>


</div>
