openapi: 3.0.3
info:
  title: PoliTech API (generated from controllers)
  version: 1.0.0
  description: >
    OpenAPI specification built from Spring controllers.
    WARNING: Some endpoints return placeholder/null responses in code.
servers:
  - url: http://localhost:8080
    description: Local development

tags:
  - name: dashboard
  - name: admin-clients
  - name: admin-accounts
  - name: auth
  - name: admin-lobs
  - name: admin-tenants
  - name: admin-product-roles
  - name: admin-logins
  - name: admin-admins
  - name: admin-products
  - name: admin-files
  - name: sales
  - name: admin-client-configuration
  - name: admin-calculators
  - name: payments
  - name: numbers

paths:
  /api/v1/{tenantCode}/dashboard/chart:
    get:
      tags: [dashboard]
      summary: Get dashboard chart
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: period
          in: query
          required: false
          schema:
            type: string
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Chart response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DashboardChartResponse"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/dashboard/cards:
    get:
      tags: [dashboard]
      summary: Get dashboard cards
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Cards response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DashboardCardsResponse"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/clients:
    post:
      tags: [admin-clients]
      summary: Create client
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Client"
      responses:
        "200":
          description: Created client
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Client"
      security:
        - bearerAuth: []
    get:
      tags: [admin-clients]
      summary: List clients
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of clients
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Client"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/clients/{clientId}:
    get:
      tags: [admin-clients]
      summary: Get client by id
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Client
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Client"
      security:
        - bearerAuth: []
    put:
      tags: [admin-clients]
      summary: Update client
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Client"
      responses:
        "200":
          description: Updated client
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Client"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/clients/{clientId}/products:
    get:
      tags: [admin-clients]
      summary: List client products
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Product roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProductRole"
      security:
        - bearerAuth: []
    post:
      tags: [admin-clients]
      summary: Grant client product
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductRole"
      responses:
        "201":
          description: Created
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/clients/{clientId}/products/{productRoleId}:
    delete:
      tags: [admin-clients]
      summary: Revoke client product
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: productRoleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "202":
          description: Accepted
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/accounts:
    post:
      tags: [admin-accounts]
      summary: Create account
      # WARNING: implementation currently returns a placeholder response.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAccountRequest"
      responses:
        "201":
          description: Created
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/accounts/{accountId}:
    get:
      tags: [admin-accounts]
      summary: Get account
      # WARNING: implementation currently returns null.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Account payload
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/accounts/{accountId}/accounts:
    get:
      tags: [admin-accounts]
      summary: Get sub-accounts
      # WARNING: implementation currently returns null.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Sub-accounts
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
      security:
        - bearerAuth: []
    post:
      tags: [admin-accounts]
      summary: Create sub-account
      # WARNING: implementation currently returns a placeholder response.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAccountRequest"
      responses:
        "201":
          description: Created
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/accounts/hierarchy:
    get:
      tags: [admin-accounts]
      summary: Get account hierarchy
      # WARNING: implementation currently returns null.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Hierarchy
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/accounts/createSubaccount:
    post:
      tags: [admin-accounts]
      summary: Create subaccount (simple)
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Account"
      responses:
        "200":
          description: Account
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Account"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/accounts/getProductRoles/{accountId}:
    get:
      tags: [admin-accounts]
      summary: Get product roles for account
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Roles
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/auth/me:
    get:
      tags: [auth]
      summary: Current user (principal)
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Principal
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Principal"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/auth/context:
    get:
      tags: [auth]
      summary: Current user context
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Context
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/auth/check-product-access:
    get:
      tags: [auth]
      summary: Check product permissions
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Access flags
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/auth/login:
    post:
      tags: [auth]
      summary: Login (simple auth)
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Token response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"

  /api/v1/{tenantCode}/auth/token:
    post:
      tags: [auth]
      summary: Generate JWT token
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TokenRequest"
      responses:
        "200":
          description: Token response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"

  /api/v1/{tenantCode}/auth/refresh-token:
    post:
      tags: [auth]
      summary: Generate refresh token
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TokenRequest"
      responses:
        "200":
          description: Token response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"

  /api/v1/{tenantCode}/auth/set-password:
    post:
      tags: [auth]
      summary: Set password
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetPasswordRequest"
      responses:
        "200":
          description: Status
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/lobs:
    get:
      tags: [admin-lobs]
      summary: List LOBs
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: LOB summaries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LobSummary"
      security:
        - bearerAuth: []
    post:
      tags: [admin-lobs]
      summary: Create LOB
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LobModel"
      responses:
        "200":
          description: Created LOB
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LobModel"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/lobs/{code}:
    get:
      tags: [admin-lobs]
      summary: Get LOB by code
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: LOB
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LobModel"
      security:
        - bearerAuth: []
    put:
      tags: [admin-lobs]
      summary: Update LOB
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: code
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LobModel"
      responses:
        "200":
          description: Updated LOB
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LobModel"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/lobs/{id}:
    delete:
      tags: [admin-lobs]
      summary: Soft delete LOB
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Deleted
        "404":
          description: Not found
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/lobs/{code}/example:
    get:
      tags: [admin-lobs]
      summary: LOB JSON example
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Example JSON
          content:
            text/plain:
              schema:
                type: string
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/tenants:
    get:
      tags: [admin-tenants]
      summary: List tenants
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Tenants
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Tenant"
      security:
        - bearerAuth: []
    post:
      tags: [admin-tenants]
      summary: Create tenant
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Tenant"
      responses:
        "201":
          description: Created tenant
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tenant"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/tenants/{tid}:
    put:
      tags: [admin-tenants]
      summary: Update tenant
      # WARNING: controller ignores {tid} param; uses request body only.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: tid
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Tenant"
      responses:
        "200":
          description: Updated tenant
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tenant"
      security:
        - bearerAuth: []
    delete:
      tags: [admin-tenants]
      summary: Delete tenant
      # WARNING: controller deletes by tenantCode, not {tid}.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: tid
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Deleted
      security:
        - bearerAuth: []

  /api/admin/product-roles:
    post:
      tags: [admin-product-roles]
      summary: Assign product role
      # WARNING: CRUD uses different DTOs for create/update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignProductRoleRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []

  /api/admin/product-roles/{productRoleId}:
    put:
      tags: [admin-product-roles]
      summary: Update product role
      # WARNING: implementation returns success without payload.
      parameters:
        - name: productRoleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProductRoleRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []
    delete:
      tags: [admin-product-roles]
      summary: Revoke product role
      parameters:
        - name: productRoleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Revoked
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []

  /api/admin/product-roles/account/{accountId}:
    get:
      tags: [admin-product-roles]
      summary: Get product roles by account
      # WARNING: implementation currently returns null.
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Roles
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/logins:
    post:
      tags: [admin-logins]
      summary: Create login
      # WARNING: create/update use different DTOs.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateLoginRequest"
      responses:
        "200":
          description: Login
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginDto"
      security:
        - bearerAuth: []
    get:
      tags: [admin-logins]
      summary: List logins
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Logins
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LoginDto"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/logins/{loginId}:
    patch:
      tags: [admin-logins]
      summary: Update login (partial)
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: loginId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLoginRequest"
      responses:
        "200":
          description: Login
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginDto"
      security:
        - bearerAuth: []
    put:
      tags: [admin-logins]
      summary: Update login (full)
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: loginId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLoginRequest"
      responses:
        "200":
          description: Login
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginDto"
      security:
        - bearerAuth: []
    delete:
      tags: [admin-logins]
      summary: Delete login
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: loginId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "204":
          description: Deleted
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admins/roles:
    post:
      tags: [admin-admins]
      summary: Create admin role
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoleAssignmentRequest"
      responses:
        "200":
          description: Admin response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminResponse"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admins/roles/{roleName}:
    get:
      tags: [admin-admins]
      summary: Get admins by role
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: roleName
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Admin list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AdminResponse"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admins/roles/{roleId}:
    delete:
      tags: [admin-admins]
      summary: Delete admin role
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: roleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "204":
          description: Deleted
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products:
    get:
      tags: [admin-products]
      summary: List products
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Product"
      security:
        - bearerAuth: []
    post:
      tags: [admin-products]
      summary: Create product
      # WARNING: create uses ProductVersionModel (not Product).
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductVersionModel"
      responses:
        "200":
          description: Created version
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductVersionModel"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products/{accountId}:
    get:
      tags: [admin-products]
      summary: Get products by account id
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: accountId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Product"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products/{productId}/versions/{versionNo}:
    get:
      tags: [admin-products]
      summary: Get product version
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Product version
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductVersionModel"
      security:
        - bearerAuth: []
    put:
      tags: [admin-products]
      summary: Update product version
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductVersionModel"
      responses:
        "200":
          description: Updated version
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductVersionModel"
      security:
        - bearerAuth: []
    delete:
      tags: [admin-products]
      summary: Delete product version
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Deleted
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products/{productId}/versions/{versionNo}/cmd/create:
    post:
      tags: [admin-products]
      summary: Create product version
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Created version
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductVersionModel"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products/{productId}/versions/{versionNo}/cmd/publish:
    post:
      tags: [admin-products]
      summary: Publish product version
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Published version
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductVersionModel"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products/{productId}:
    delete:
      tags: [admin-products]
      summary: Delete product
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Deleted
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products/{productId}/versions/{versionNo}/example_quote:
    get:
      tags: [admin-products]
      summary: Get example quote JSON
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Example JSON
          content:
            text/plain:
              schema:
                type: string
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/products/{productId}/versions/{versionNo}/example_save:
    get:
      tags: [admin-products]
      summary: Get example save JSON
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Example JSON
          content:
            text/plain:
              schema:
                type: string
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/files:
    post:
      tags: [admin-files]
      summary: Upload file
      # WARNING: multipart upload; consumes not declared in controller.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: Uploaded file id
          content:
            application/json:
              schema:
                type: object
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/files/{fileId}:
    delete:
      tags: [admin-files]
      summary: Delete file
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: fileId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "204":
          description: Deleted
      security:
        - bearerAuth: []
    get:
      tags: [admin-files]
      summary: Download file
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: fileId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: File content
          content:
            application/pdf:
              schema:
                type: string
                format: binary
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/sales/policies/{policyNumber}:
    put:
      tags: [sales]
      summary: Update policy
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: policyNumber
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: string
      responses:
        "200":
          description: Policy data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PolicyData"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/sales:
    get:
      tags: [sales]
      summary: List policies
      # WARNING: controller maps GET /sales to policies list.
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Policies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PolicyData"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/sales/{policyNumber}:
    get:
      tags: [sales]
      summary: Get policy by number
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: policyNumber
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Policy data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PolicyData"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/sales/{policyNumber}/paid:
    post:
      tags: [sales]
      summary: Mark policy as paid
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: policyNumber
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentRequest"
      responses:
        "200":
          description: OK
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/sales/quotes:
    post:
      tags: [sales]
      summary: Calculate quote
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: string
      responses:
        "200":
          description: Quote response (JSON string)
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []
    get:
      tags: [sales]
      summary: Get account quotes
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: qstr
          in: query
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Quotes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/QuoteDto"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/sales/policies:
    post:
      tags: [sales]
      summary: Save policy
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: string
      responses:
        "200":
          description: Save response (JSON string)
          content:
            application/json:
              schema:
                type: string
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/sales/policies/{policy-nr}/printpf/{pf-type}:
    get:
      tags: [sales]
      summary: Print policy form
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: policy-nr
          in: path
          required: true
          schema:
            type: string
        - name: pf-type
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Binary file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/clients/configuration/{clientId}:
    post:
      tags: [admin-client-configuration]
      summary: Create client configuration
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClientConfiguration"
      responses:
        "200":
          description: Client configuration
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ClientConfiguration"
      security:
        - bearerAuth: []
    put:
      tags: [admin-client-configuration]
      summary: Update client configuration
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClientConfiguration"
      responses:
        "200":
          description: Client configuration
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ClientConfiguration"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/calculators/products/{productId}/versions/{versionNo}/packages/{packageNo}:
    get:
      tags: [admin-calculators]
      summary: Get calculator
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
        - name: packageNo
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Calculator
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CalculatorModel"
      security:
        - bearerAuth: []
    post:
      tags: [admin-calculators]
      summary: Create calculator
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
        - name: packageNo
          in: path
          required: true
          schema:
            type: integer
        - name: productCode
          in: query
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Calculator
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CalculatorModel"
      security:
        - bearerAuth: []
    put:
      tags: [admin-calculators]
      summary: Replace calculator
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: versionNo
          in: path
          required: true
          schema:
            type: integer
        - name: packageNo
          in: path
          required: true
          schema:
            type: integer
        - name: productCode
          in: query
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CalculatorModel"
      responses:
        "200":
          description: Calculator
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CalculatorModel"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/calculators/{calculatorId}/coefficients/{code}:
    get:
      tags: [admin-calculators]
      summary: Get coefficients table
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: calculatorId
          in: path
          required: true
          schema:
            type: integer
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Coefficients table
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JsonNode"
      security:
        - bearerAuth: []
    post:
      tags: [admin-calculators]
      summary: Create coefficients table
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: calculatorId
          in: path
          required: true
          schema:
            type: integer
        - name: code
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ArrayNode"
      responses:
        "200":
          description: Coefficients table
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ArrayNode"
      security:
        - bearerAuth: []
    put:
      tags: [admin-calculators]
      summary: Replace coefficients table
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: calculatorId
          in: path
          required: true
          schema:
            type: integer
        - name: code
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ArrayNode"
      responses:
        "200":
          description: Coefficients table
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ArrayNode"
      security:
        - bearerAuth: []

  /api/v1/{tenantCode}/admin/calculators/{calculatorId}/prc/syncvars:
    post:
      tags: [admin-calculators]
      summary: Sync calculator variables
      parameters:
        - name: tenantCode
          in: path
          required: true
          schema:
            type: string
        - name: calculatorId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: OK
      security:
        - bearerAuth: []

  /api/v1/payments/youkassa/webhook:
    post:
      tags: [payments]
      summary: YooKassa webhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: OK
        "500":
          description: Error

  /api/v1/payments/youkassa/redirect:
    get:
      tags: [payments]
      summary: YooKassa redirect
      parameters:
        - name: successTarget
          in: query
          required: true
          schema:
            type: string
            format: uri
        - name: failTarget
          in: query
          required: false
          schema:
            type: string
            format: uri
      responses:
        "302":
          description: Redirect

  /api/v1/numbers/next:
    get:
      tags: [numbers]
      summary: Get next number
      # WARNING: parameters lack annotations in controller.
      parameters:
        - name: productCode
          in: query
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Next number
          content:
            text/plain:
              schema:
                type: string

  /api/v1/numbers:
    post:
      tags: [numbers]
      summary: Create number generator
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NumberGeneratorDescription"
      responses:
        "201":
          description: Created
    put:
      tags: [numbers]
      summary: Update number generator
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NumberGeneratorDescription"
      responses:
        "200":
          description: Updated

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    DashboardChartResponse:
      type: object
      description: Chart response
      x-java-class: ru.pt.api.dto.dashboard.DashboardChartResponse
    DashboardCardsResponse:
      type: object
      description: Cards response
      x-java-class: ru.pt.api.dto.dashboard.DashboardCardsResponse
    Client:
      type: object
      x-java-class: ru.pt.api.dto.auth.Client
    ProductRole:
      type: object
      x-java-class: ru.pt.api.dto.auth.ProductRole
    CreateAccountRequest:
      type: object
      x-java-class: ru.pt.api.admin.AccountManagementController.CreateAccountRequest
    Account:
      type: object
      x-java-class: ru.pt.api.dto.auth.Account
    Principal:
      type: object
      x-java-class: ru.pt.api.dto.auth.Principal
    LoginRequest:
      type: object
      x-java-class: ru.pt.auth.model.LoginRequest
    TokenRequest:
      type: object
      x-java-class: ru.pt.auth.model.TokenRequest
    TokenResponse:
      type: object
      x-java-class: ru.pt.auth.model.TokenResponse
    SetPasswordRequest:
      type: object
      x-java-class: ru.pt.api.admin.dto.SetPasswordRequest
    LobModel:
      type: object
      x-java-class: ru.pt.api.dto.product.LobModel
    LobSummary:
      type: object
      description: Map with id, mpCode, mpName
    Tenant:
      type: object
      x-java-class: ru.pt.api.dto.auth.Tenant
    AssignProductRoleRequest:
      type: object
      x-java-class: ru.pt.api.admin.ProductRoleManagementController.AssignProductRoleRequest
    UpdateProductRoleRequest:
      type: object
      x-java-class: ru.pt.api.admin.ProductRoleManagementController.UpdateProductRoleRequest
    CreateLoginRequest:
      type: object
      x-java-class: ru.pt.api.admin.dto.CreateLoginRequest
    UpdateLoginRequest:
      type: object
      x-java-class: ru.pt.api.admin.dto.UpdateLoginRequest
    LoginDto:
      type: object
      x-java-class: ru.pt.auth.model.LoginDto
    RoleAssignmentRequest:
      type: object
      x-java-class: ru.pt.api.admin.AdminManagementController.RoleAssignmentRequest
    AdminResponse:
      type: object
      x-java-class: ru.pt.auth.model.AdminResponse
    Product:
      type: object
      x-java-class: ru.pt.api.dto.product.Product
    ProductVersionModel:
      type: object
      x-java-class: ru.pt.api.dto.product.ProductVersionModel
    PolicyData:
      type: object
      x-java-class: ru.pt.api.dto.db.PolicyData
    QuoteDto:
      type: object
      x-java-class: ru.pt.api.dto.sales.QuoteDto
    PaymentRequest:
      type: object
      x-java-class: ru.pt.api.admin.dto.PaymentRequest
    ClientConfiguration:
      type: object
      x-java-class: ru.pt.api.dto.auth.ClientConfiguration
    CalculatorModel:
      type: object
      x-java-class: ru.pt.api.dto.calculator.CalculatorModel
    JsonNode:
      type: object
      description: Jackson JsonNode
      x-java-class: com.fasterxml.jackson.databind.JsonNode
    ArrayNode:
      type: array
      description: Jackson ArrayNode
      items:
        type: object
      x-java-class: com.fasterxml.jackson.databind.node.ArrayNode
    NumberGeneratorDescription:
      type: object
      x-java-class: ru.pt.api.dto.numbers.NumberGeneratorDescription
