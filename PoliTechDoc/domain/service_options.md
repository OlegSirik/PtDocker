Overview

К страховому договору может быть добавлен пакет не страховых опций.
Это могут быть, например, эвакуация авто, ремонт техники, оценка квартиры, аварком и т.д.
Опции могут поставлятся разными провайдерами услуг, но продаваться единым пакетом со страховым договором.

Схема данных

ServiceOptions: [{
    tid:
        type: long
        description: tenant id
    code:
        type: string
        example: "ROADSIDE_ASSISTANCE"
        description: уникальный код услуги
    name:
        type: string
        example: "Помощь на дороге"
    category:
        type: string #enum: [assistance, legal, medical]
        description: "категория опции. если будет слишком много, можно разбить на группы."
    price:
        type: number
        description: "стоимость опции"
    contractNr:
        type: string
        description: "номер договора/сертификата не оказание услуги, если это применимо"
    isSelected:
        type: boolean
        description: при запросе на котироку, признак что опция выбрана
}]
primary key (id)
unique key(tid, code)
unique key(tid, name)

При предрасчете, к ответу крепится список доступных опций. 
Он зависит от линии бизнеса и каких-то еще правил

правила описываем на текущем DSL { code, operation, code or value }. можно прикрепить deepseek

Клиент выбирает то что ему нужно и либо отправляет на повторный расчет ( isSelected = true )
Либо создает договор с выбранными опциями.

Должен быть 

1. Справочник опций ( id, tid, code, name, category, price, provider_id )
2. Справочник поставщиков sp_service_providers( id, name, properties  )
Поставщик может быть онлайн или офлайн. Тогда есть пул номеров, или количество сертов, которые можно продавать без онлайн запросов.
Пока расматриваем только офлайн
3. Прайслист ( code, name, price, catrgory, status (suspend, online ), amount_free, amount_booked, amount_sold, number_generator )

будет 
Поставщик , тип взаимодействия. ( онлайн - офлайн )
ROADSIDE_ASSISTANCE, поставщик, цена, количество в офлайне
факты продажи ( договор страхования, ИД сертификата , дата сумма)

содание договора - полиси индекс + ( полиси_идб сервис идб сумма дата статус)
оплата - смета статуса везде
возврат серта в пул продажи ( статус - просрочена оплата )

В тенанте есть список доступных поставщиков + сервисов
клиенту даются права на конкретный сервис ( да - нет ), + лимит продажи 
печатка 
реестр сервисных договоров 
страховатеь , сервис цена, 


1. Добавляем сервис в справочник
name, provider, amount, price
2. ставим статус онлайн
3. привязываем проукты, к которым сервис предлагается ( tid, product_id, service_id )
4. после расчета, если все прошло успешно находим доступные опции, если опции были в запросе то проверяем что они доступны к продаже и выставляем цену.
Оставляем доступные со статусом селектед, остальное селектед-фолс
5. считаем сервисЭмаунт, как сумму опций с флаго селектед=тру
6. считаем тоталЭмаунь как премия + сервисЭмаунт

Если это создание договора то вызываем PolicyOptionsService.create(tid, optionId, policy_id).
проверяем - сервис онлайн офлайн
если онлайн то вызываем внешний АПИ
если офлайн то генерим номер, переносим 1 штуку в статус холд, создаем запись о продаже, линкуем к страховому договору( ид договора и ид опции уникальное )

