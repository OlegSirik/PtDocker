# ADR-004: Архитектура авторизации

## Статус
Принято

## Контекст
Система требует гибкой модели авторизации, поддерживающей:
- Мультитенантность
- Богатые доменные правила
- Интеграцию с OAuth2 / Keycloak
- Четкое разделение ответственностей

## Решение
Система использует гибридную модель авторизации:

1. RBAC (Role-Based Access Control) для крупнозернистого доступа
2. Политико-ориентированную авторизацию для детальных доменных правил

Разрешения RBAC сопоставляются с областями OAuth2 и
применяются с использованием Spring Security.

Детальная авторизация реализуется через
AuthorizationService и AuthorizationPolicy.

## Рассмотренные альтернативы

### Службы авторизации Keycloak
Отклонено из-за:
- Логика домена вне кодовой базы
- Сложность тестирования
- Привязка к поставщику

### Чистый RBAC
Отклонено из-за:
- Невозможности выражения доменных ограничений
- Взрывного роста количества разрешений

### Чистый ABAC
Отклонено из-за:
- Избыточной сложности
- Снижения читаемости

## Последствия
- Четкое разделение между аутентификацией и авторизацией
- Доменные правила остаются в коде
- Логика авторизации тестируема и аудируема