# Версионирование

Любое изменение договора страхования влечет за собой создание замороженной версии всех условий договора на момент создания.
Версия договора это - immutable object.

Возможные изменения - нб, доп.соглашение, пролонгация, расторг, пересоздание.
```
Policy:
  type: object
  properties:
    policyId: { type: string }
    policyNumber: { type: string }
    productCode: { type: string }
    currentVersionId: { type: string }
    versions:
      type: array
      items:
        $ref: '#/components/schemas/PolicyVersion'

PolicyVersion:
  type: object 
  properties:
    versionNo: {type: string}
    effectiveDate: {description: дата вступления версии в силу }
    expirationDate: {description: Когда перестает действовать }
    patches: 
    type: array
      items:
        $ref: '#/components/schemas/PolicyPatch'

PolicyPatch:
  type: object
  properties:
    id: {type: string; }
    patchType:
      type: string
      enum: [NewBusiness, Endorsement, Renewal, Cancellation]
    patchReason:
      type: string
      enum: [ChangeDriver, ChangePhName, ChangePHIds, etc ]
      description: Описывает изменения. применимо в случае доп соглашения. каждое изменение обновляет свой определенный набор данных. Его проще проерить и далее указать в ПФ. Если изменений много, то под каждое изменение отдельная запись.
    patchStatus: 
      type: string
      enum: [InProgress, Bound, Issued, Paid]
    patchDate: { type: string, format: date-time }
```

# Что изменяет договор
## NewBusiness
Создание нового договора
## Endorsement, Addendum
Изменение условий действующего договора в период его действия.
Можно поменять почти все. 
## Cancellation
Прекращение договора (полностью) до окончания срока.
Обновляемые поля:
- cancellationDate
- cancellationReason
- returnPremiumAmount
- status = "cancelled"
## Renewal 
Продление договора на следующий страховой период.
Возможно 2 сценария
1. Создание нового договора на основе старого, с другим номером.
2. Создание версии договора, со старым номером и суффиксом продления, например POL25-001-NR01

# UI Flow 
1. Выбрать продукт
2. Данные страхователя
3. Объект страхования
4. Динамический вопросник ( зависит от первых шагов, сейчас нет )
5. Выбор покрытий и лимитов
6. Расчет, экран с ценой. 
7. Документы, киды и т.д.
8. Подтверждение сделки ( код смс )
9. Выпуск договора.

# Вопросник. От чего зависит состав вопросника
1. От типа страхового продукта
Каждый продукт хранит свой набор вопросов.
Примеры:
Автострахование → вопросы про водителей
Недвижимость → вопросы про сигнализацию
Путешествия → вопросы про страну поездки

2. От выбранных покрытий
Если страхователь выбрал конкретное покрытие — система добавляет специфичные вопросы.
Пример:
Покрытие “КАСКО” → спрашиваем про гараж, сигнализацию
Покрытие “Несчастный случай” → профессия, спортивные нагрузки
Покрытие “Гражданская ответственность” → наличие животных, размер дома

3. От атрибутов объекта страхования
Какие риски есть у объекта → такие вопросы появятся.
Примеры:
Авто старше 10 лет → вопрос об оценке
Дом из дерева → вопросы о противопожарных мероприятиях
Электроника дороже X → есть ли чехол?

4. От предыдущих ответов (conditional questions)
Если ответ “Да” → открываются уточняющие вопросы.
Пример:
Q1: Есть ли охранная сигнализация?
  → Если Да:
      Q2: Какая модель сигнализации?
  → Если Нет:
      Q3: Почему отсутствует сигнализация?

5. От канала продаж (web / агент / партнёр / B2B)
Часто:
для агента — больше технических вопросов
для онлайн-покупателя — минимум вопросов
для брокера — специальный набор

6. От юрисдикции / региона
Регуляторы могут требовать свои вопросы.
Пример:
Германия → согласие GDPR
США → штатовские ответы по liability
UK FCA → агенты обязаны задавать вопросы по квалификации

7. От сценария транзакции
Тип транзакции меняет вопросник:
Новый договор (New Business) — полный набор
Продление (Renewal) — только изменившиеся вопросы
Изменение (Endorsement) — только вопросы по изменению
Оферта → минимальный набор

8. От профиля клиента
Например:
corporate client → дополнительные вопросы по владельцам
VIP-пакет → вопросы о лимитах и concierge-риск
молодой водитель → вопросы о стаже, курсах безопасного вождения


