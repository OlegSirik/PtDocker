# Концептуальная модель системы страховых продуктов
##Общий принцип

Система построена вокруг эволюции **одной максимальной доменной модели**
→ через ограничения
→ к продукту
→ к расчёту
→ с жёсткой фиксацией при выходе в прод.

Ключевая идея:

**Максимальная модель → ограничения → специализация → фиксация**

## 1. Максимальная модель страхового договора (Canonical Model)
### Назначение

Максимальная модель описывает все возможные атрибуты страхового договора, которые в принципе могут понадобиться системе — независимо от линии бизнеса или продукта.

### Характеристики

Не привязана к конкретному продукту

Включает:

страхователя

застрахованных лиц / объекты

риски

покрытия

лимиты, премии, сроки

вспомогательные и вычисляемые атрибуты

Является источником истины для всех последующих моделей

### Роль

Единый доменный словарь

Основа для:

продуктового моделирования

валидаций

расчётов

печатных форм

## 2. Линия бизнеса (Line of Business, LoB)
### Назначение

Линия бизнеса ограничивает максимальную модель в рамках конкретного класса страхования.

### Что делает LoB

Фиксирует:

тип страхователя (физлицо, юрлицо и т.д.)

тип объекта страхования (жизнь, здоровье, имущество, ответственность и т.п.)

Определяет:

какие сущности из максимальной модели допустимы

какие запрещены

Может вводить:

глобальные константы

общие правила для всех продуктов линии

### Важно

LoB не добавляет бизнес-специфику продукта

LoB — это рамка, а не конечное предложение

## 3. Продукт (Insurance Product)
Назначение

Продукт — это конкретное страховое предложение, доступное для продажи.

Что делает продукт
### 3.1. Формирует продуктовую модель

Удаляет ненужные атрибуты из модели LoB

Фиксирует:

структуру объектов

обязательность полей

Добавляет:

атрибуты покрытий

продуктовые параметры

### 3.2. Описывает валидации

Обязательность

Диапазоны значений

Условные правила

Зависимости между полями

### 3.3. Генерирует интерфейсы

По продуктовой модели можно:

автоматически собрать экранную форму

сформировать JSON-запрос:

для расчёта

для создания договора

Ключевое свойство

Продукт определяет, какие данные вообще могут существовать

## 4. Калькулятор (Pricing / Rating)
Назначение

Калькулятор отвечает только за расчёт, не за структуру данных.

Что делает калькулятор

Работает поверх модели продукта

Добавляет:

формулы

коэффициенты

константы

Описывает:

шаги выполнения расчёта

порядок вычислений

зависимости между значениями

Важно

Калькулятор не может добавлять новые атрибуты

Он использует только то, что разрешено продуктом

## 5. Фиксация при выходе в прод (Product Freeze)
Критически важное правило

После вывода версии продукта в прод:
структура модели и калькулятора становится неизменяемой

Что именно фиксируется

Набор атрибутов

Структура объектов

Валидации

Формулы

Шаги расчёта

Что допускается после

Только:

новая версия продукта

новая версия калькулятора

Старые договоры всегда обслуживаются своей версией

Причины

Воспроизводимость расчётов

Аудит

Юридическая значимость

Отсутствие “плавающего” поведения

## 6. Итоговая иерархия (mental model)
Максимальная модель
        ↓
   Линия бизнеса
        ↓
      Продукт
        ↓
    Калькулятор
        ↓
     Версия в прод (immutable)

## 7. Ключевые принципы системы

Single source of truth — максимальная модель

Progressive restriction — каждый уровень только сужает

Separation of concerns:

модель ≠ расчёт

продукт ≠ калькулятор

Version immutability — прод = неизменяемо
